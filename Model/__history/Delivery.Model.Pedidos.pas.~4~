unit Delivery.Model.Pedidos;

interface

uses
  Delivery.Model.Interfaces, Data.DB, Delivery.Model.Connection.Interfaces;
type
  TModelPedidos = class(TInterfacedObject, iModelPedidos)
    private
      FQuery : iModelQuery;
    public
      constructor Create;
      destructor Destroy; override;
      class function New: iModelPedidos;
      function QuantidadeDePedidos : integer;
      function Pedidos : TDataSet; overload;
      function Pedidos(ID : integer): TDataSet; overload;
      function ItensPedido(ID : integer): TDataSet;
  end;

implementation

uses
  Delivery.Model.Firedac.Query, System.SysUtils;


{ TModelPedidos }

constructor TModelPedidos.Create;
begin
  FQuery := TModelFiredacQuery.New;
end;

destructor TModelPedidos.Destroy;
begin

  inherited;
end;

function TModelPedidos.ItensPedido(ID: integer): TDataSet;
begin
  try
    FQuery.Open('SELECT * FROM Pedido_itens where idPedido = '+QuotedStr(ID.ToString));
  except
  end;

  Result := FQuery.DataSet;
end;

class function TModelPedidos.New: iModelPedidos;
begin
  Result := self.Create;
end;

function TModelPedidos.Pedidos: TDataSet;
begin
  try
    FQuery.Open('SELECT * FROM Pedidos');
  except
  end;

  Result := FQuery.DataSet;
end;

function TModelPedidos.Pedidos(ID : integer): TDataSet;
begin
  try
    FQuery.Open('SELECT * FROM Pedidos where id = '+QuotedStr(ID.ToString));
  except
  end;

  Result := FQuery.DataSet;
end;

function TModelPedidos.QuantidadeDePedidos: integer;
begin
  try
    FQuery.Open('SELECT * FROM Pedidos');
  except
  end;

  Result := FQuery.DataSet.RecordCount;
end;

end.
